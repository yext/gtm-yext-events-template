___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Yext Analytics Browser SDK",
  "categories": ["ANALYTICS", "ATTRIBUTION", "CONVERSION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": "Use the Yext Analytics Browser SDK template to track events and send them to Yext using the Yext Analytics SDK and the Yext Events API.\nhttps://github.com/yext/analytics\nhttps://hitchhikers.yext.com/",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "eventType",
    "displayName": "Event Type",
    "selectItems": [
      {
        "value": "Basic",
        "displayValue": "Basic"
      },
      {
        "value": "Conversion",
        "displayValue": "Conversion"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true,
    "defaultValue": "Universal",
    "help": "The type of event that you’d like to send to Yext. All event types require a Yext API Key with the necessary access permissions, Cloud Region, and Session Tracking Toggle. The Basic event type allows you to specify any user action, either from the list of standard events that Yext Analytics supports, or any arbitrary custom analytics event that is accepted by the Events API. The Conversion event type is specifically for reporting conversion events with a value and currency. Additional properties can be set for both event types.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "apiKey",
    "displayName": "Yext API Key (Required)",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "Yext API Key is required. Can be retrieved from the Developer Console in the Customer Portal, from an App with read/write permissions on the Events API."
      },
      {
        "type": "REGEX",
        "args": [
          "^.{32}$"
        ]
      }
    ],
    "help": "The Yext API Key can be retrieved from an app in the Developer Console in the Customer Portal with read/write permission on the Events API.",
    "alwaysInSummary": true
  },
  {
    "type": "SELECT",
    "name": "partition",
    "displayName": "Cloud Region (Required)",
    "selectItems": [
      {
        "value": "US",
        "displayValue": "US"
      },
      {
        "value": "EU",
        "displayValue": "EU"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "US",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true,
    "help": "The cloud region that your Yext account is located in."
  },
  {
    "type": "SELECT",
    "name": "sessionTracking",
    "displayName": "Enable Session Tracking (Required)",
    "selectItems": [
      {
        "value": true,
        "displayValue": "true"
      },
      {
        "value": false,
        "displayValue": "false"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "True",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true,
    "help": "Enable session tracking to stitch together sequential events triggered by a user in a single browser session."
  },
  {
    "type": "TEXT",
    "name": "conversionValue",
    "displayName": "Conversion Value",
    "simpleValueType": true,
    "defaultValue": 0,
    "help": "The value associated with this Conversion Event.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "Conversion",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversionValueCurrency",
    "displayName": "Conversion Value Currency",
    "simpleValueType": true,
    "defaultValue": "USD",
    "help": "The currency of the value associated with this Conversion Event.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "Conversion",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "actionType",
    "displayName": "Action Type",
    "selectItems": [
      {
        "value": "Standard",
        "displayValue": "Standard"
      },
      {
        "value": "Custom",
        "displayValue": "Custom"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "Standard",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true,
    "help": "Whether the user action is one of the standard actions that Yext Analytics supports, or an arbitrary custom action. For a list of supported standard actions, see \u003ca href \u003d\u0027https://hitchhikers.yext.com/docs/eventsapis/events/events#operation/sendEvents\u0027\u003eHitchhikers\u003c/a\u003e."
  },
  {
    "type": "SELECT",
    "name": "standardAction",
    "displayName": "Action",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "ADD_TO_CART",
        "displayValue": "ADD_TO_CART"
      },
      {
        "value": "ALL_TAB_NAVIGATION",
        "displayValue": "ALL_TAB_NAVIGATION"
      },
      {
        "value": "APPLY",
        "displayValue": "APPLY"
      },
      {
        "value": "AUTO_COMPLETE_SELECTION",
        "displayValue": "AUTO_COMPLETE_SELECTION"
      },
      {
        "value": "BACKWARD_PAGINATE",
        "displayValue": "BACKWARD_PAGINATE"
      },
      {
        "value": "BOOK",
        "displayValue": "BOOK"
      },
      {
        "value": "BRAND_ICON",
        "displayValue": "BRAND_ICON"
      },
      {
        "value": "CASE_START",
        "displayValue": "CASE_START"
      },
      {
        "value": "CASE_SUBMITTED",
        "displayValue": "CASE_SUBMITTED"
      },
      {
        "value": "CHAT_IMPRESSION",
        "displayValue": "CHAT_IMPRESSION"
      },
      {
        "value": "CHAT_LINK_CLICK",
        "displayValue": "CHAT_LINK_CLICK"
      },
      {
        "value": "CHAT_RESPONSE",
        "displayValue": "CHAT_RESPONSE"
      },
      {
        "value": "COLLAPSE",
        "displayValue": "COLLAPSE"
      },
      {
        "value": "CTA_CLICK",
        "displayValue": "CTA_CLICK"
      },
      {
        "value": "DRIVING_DIRECTIONS",
        "displayValue": "DRIVING_DIRECTIONS"
      },
      {
        "value": "EVENT",
        "displayValue": "EVENT"
      },
      {
        "value": "EXPAND",
        "displayValue": "EXPAND"
      },
      {
        "value": "FEATURED_MESSAGE",
        "displayValue": "FEATURED_MESSAGE"
      },
      {
        "value": "FILTERING_WITHIN_SECTION",
        "displayValue": "FILTERING_WITHIN_SECTION"
      },
      {
        "value": "FORWARD_PAGINATE",
        "displayValue": "FORWARD_PAGINATE"
      },
      {
        "value": "HEADER_LINKS",
        "displayValue": "HEADER_LINKS"
      },
      {
        "value": "ITEM_IN_LIST",
        "displayValue": "ITEM_IN_LIST"
      },
      {
        "value": "MAP_CARD",
        "displayValue": "MAP_CARD"
      },
      {
        "value": "MAP_PIN",
        "displayValue": "MAP_PIN"
      },
      {
        "value": "MENU",
        "displayValue": "MENU"
      },
      {
        "value": "MESSAGE",
        "displayValue": "MESSAGE"
      },
      {
        "value": "ORDER",
        "displayValue": "ORDER"
      },
      {
        "value": "PAGE_VIEW",
        "displayValue": "PAGE_VIEW"
      },
      {
        "value": "PAGINATE",
        "displayValue": "PAGINATE"
      },
      {
        "value": "POST",
        "displayValue": "POST"
      },
      {
        "value": "PRESET_PROMPT",
        "displayValue": "PRESET_PROMPT"
      },
      {
        "value": "PRODUCT",
        "displayValue": "PRODUCT"
      },
      {
        "value": "PROFILE",
        "displayValue": "PROFILE"
      },
      {
        "value": "QUESTION_FOCUS",
        "displayValue": "QUESTION_FOCUS"
      },
      {
        "value": "QUESTION_SUBMIT",
        "displayValue": "QUESTION_SUBMIT"
      },
      {
        "value": "REMOVED_FILTER",
        "displayValue": "REMOVED_FILTER"
      },
      {
        "value": "REVIEW",
        "displayValue": "REVIEW"
      },
      {
        "value": "SCROLL_TO_BOTTOM_OF_PAGE",
        "displayValue": "SCROLL_TO_BOTTOM_OF_PAGE"
      },
      {
        "value": "SEARCH_BAR_IMPRESSION",
        "displayValue": "SEARCH_BAR_IMPRESSION"
      },
      {
        "value": "SEARCH_CLEAR_BUTTON",
        "displayValue": "SEARCH_CLEAR_BUTTON"
      },
      {
        "value": "TAP_TO_CALL",
        "displayValue": "TAP_TO_CALL"
      },
      {
        "value": "THUMBS_DOWN",
        "displayValue": "THUMBS_DOWN"
      },
      {
        "value": "THUMBS_UP",
        "displayValue": "THUMBS_UP"
      },
      {
        "value": "TICKET_URL",
        "displayValue": "TICKET_URL"
      },
      {
        "value": "TITLE",
        "displayValue": "TITLE"
      },
      {
        "value": "VERTICAL_TAB_NAVIGATION",
        "displayValue": "VERTICAL_TAB_NAVIGATION"
      },
      {
        "value": "VERTICAL_VIEW_ALL",
        "displayValue": "VERTICAL_VIEW_ALL"
      },
      {
        "value": "VOICE_START",
        "displayValue": "VOICE_START"
      },
      {
        "value": "VOICE_STOP",
        "displayValue": "VOICE_STOP"
      },
      {
        "value": "WEBSITE",
        "displayValue": "WEBSITE"
      }
    ],
    "simpleValueType": true,
    "help": "The name of the standard action that the user has performed.",
    "alwaysInSummary": true,
    "defaultValue": "ADD_TO_CART",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "actionType",
        "paramValue": "Standard",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "customAction",
    "displayName": "Custom Action Type",
    "simpleValueType": true,
    "help": "Enter a custom action type. It must start with \u0027C_\u0027.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "^[Cc]_.+$"
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "actionType",
        "paramValue": "Custom",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": true
  },
  {
    "type": "PARAM_TABLE",
    "name": "additionalProperties",
    "displayName": "Custom Event Properties",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "eventPayloadProperty",
          "displayName": "Event Payload Property",
          "simpleValueType": true,
          "help": "The field name from the Events API Json Schema. For example, \"locale\" or for properties with subfields, \"browserAgent.browser\"."
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "value",
          "displayName": "Value",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "newRowButtonText": "Add Custom Property",
    "editRowTitle": "Editing Custom Property",
    "newRowTitle": "title",
    "help": "Use this table to add additional properties not available in the default configuration. For a list of possible options, see the Events API Schema on \u003ca href \u003d\u0027https://hitchhikers.yext.com/docs/eventsapis/events/events#operation/sendEvents\u0027\u003eHitchhikers\u003c/a\u003e. \u003cbr\u003e\u003cbr\u003e\nEnter the name of the property in the first column and its value in the second. For example, \"locale\" in the first column and \"en_US\" in the second. For properties with subfields, they can be denoted using periods. For example, to pass deviceClass you would enter \"browserAgent.deviceClass\" in the first column and \"MOBILE\" in the second. For customValues you can put customValues.myCustomVal in the first column, and its corresponding value in the second. \u003cbr\u003e\u003cbr\u003e \u003cstrong\u003eNote:\u003c/strong\u003e The values set above override what is set below.",
    "alwaysInSummary": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const queryPermission = require('queryPermission');
const createArgumentsQueue = require('createArgumentsQueue');
const log = require('logToConsole');
const callInWindow = require('callInWindow');
const injectScript = require('injectScript');
const makeNumber = require('makeNumber');

// Define Analytics Config using passed in properties
const analyticsConfig = {
    key: data.apiKey,
    sessionTrackingEnabled: data.sessionTracking,
    region: data.partition
};

const scriptURL = 'https://assets.sitescdn.net/analytics/v1.0.0-beta.3/analytics.umd.js';

// Used for converting custom event properties to json. Following the execution of this function, we have
// a JSON object with all of the properties entered into the Custom Properties Param Table. Following this
// function, we will add the action to payloadJson and add conversion properties (if applicable).
function convertUserInputToJson() {
  // Used for recursively converting nested properties to json (where parents and children are separate
  function setNestedValue(obj, keys, value) {
    const key = keys[0];
    if (keys.length === 1) {
      obj[key] = value;
    } else {
      obj[key] = obj[key] || {};
      setNestedValue(obj[key], keys.slice(1), value);
    }
  }

  // If no additional properties are added, return empty JSON
  if (data.additionalProperties === undefined) return {};

  const payloadJson = {};

  for (let i = 0; i < data.additionalProperties.length; i++) {
    const customPropertyEntry = data.additionalProperties[i];
    const propertyKey = customPropertyEntry.eventPayloadProperty;
    const propertyValue = customPropertyEntry.value;
    const parentChildKeys = propertyKey.split('.');
    setNestedValue(payloadJson, parentChildKeys, propertyValue);
  }
 return payloadJson;
}

// Call SDK function from script stored in Window. This will call report() with the config and payloadJson
// added to Window.analyticsEventPayload. This will also take care of converting user input to the correct type
function report() {
  callInWindow('AnalyticsSDK.analyticsGTM');
}

// Check permissions on injectAnalytics function, add payload and config to window object.
if (queryPermission('access_globals', 'readwrite', 'injectAnalytics')) {
      // create object analyticsEventPayload in window, and injectAnalytics function for adding to it
      const injectAnalytics = createArgumentsQueue('injectAnalytics', 'analyticsEventPayload');
      // Inject analyticsConfig as 'config' in analyticsEventPayload object
      injectAnalytics('config',  analyticsConfig);
      // Convert custom event properties to json
      const payloadJson = convertUserInputToJson();
      // If event type is conversion, and amount and currency are not null, add value property to payload
      // json using user input
      if (data.eventType === 'Conversion' && data.conversionValue && data.conversionValueCurrency) {
        payloadJson.value = {
          amount: data.conversionValue,
          currency: data.conversionValueCurrency
        };
      }
      // Add Google Tag Manager identifier to clientSdk object
      payloadJson.clientSdk = {
        GTM: "v1"
      };
      // set action in payload JSON from user input
      payloadJson.action = data.actionType === 'Custom' ? data.customAction : data.standardAction;
      // Inject payloadJson as 'payload' in analyticsEventPayload object
      injectAnalytics('payload',  payloadJson);
  } else {
    log("Insufficient privileges on 'injectAnalytics'. Read/Write required");
    data.gtmOnFailure();
}

// Inject script if we have permission. If injection is successful, will call 'AnalyticsSDK.analyticsGTM'
// using analyticsEventPayload to report data using the Yext Events API.
if (queryPermission('inject_script', scriptURL)) {
  injectScript(scriptURL, report, () => {
    log("Failed to inject script - unrelated to permissioning");
    data.gtmOnFailure();
  });
    data.gtmOnSuccess();
} else {
  log("Insufficient access to inject script. Inject Script permission required on scriptURL");
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analyticsEventPayload"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "injectAnalytics"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "config"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "AnalyticsSDK"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "AnalyticsSDK.analyticsGTM"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://assets.sitescdn.net/analytics/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test Standard Event
  code: "runCode({\n  eventType: \"Standard\", \n  apiKey: \"<insert a test api key>\"\
    ,\n  sessionTracking: \"True\",\n  partition: \"US\",\n  action: \"ADD_TO_CART\"\
    \n});\n\nassertApi('gtmOnSuccess').wasCalled();"
- name: Test Conversion Event
  code: "runCode({\n  eventType: \"Conversion\", \n  apiKey: \"<insert a test api\
    \ key>\",\n  sessionTracking: null,\n  partition: \"US\",\n  action: \"WEBSITE\"\
    ,\n  value: {\n    amount: \"50\",\n    currency: \"USD\"\n  }\n});\n\nassertApi('gtmOnSuccess').wasCalled();"
- name: Test Custom Event
  code: "runCode({\n  eventType: \"Conversion\", \n  apiKey: \"<insert a test api\
    \ key>\",\n  sessionTracking: null,\n  partition: \"US\",\n  action: \"WEBSITE\"\
    ,\n  value: {\n    amount: \"50\",\n    currency: \"USD\"\n  },\n  additionalProperties:\
    \ {\n    \"browserAgent.browser\": \"chrome\",\n    \"browserAgent.device\": \"\
    iPhone\", \n    \"customTags.myCustomTag\": {\n      \"tag\": \"tagValue\"\n \
    \   }\n  }\n});\n\nassertApi('gtmOnSuccess').wasCalled();"


___NOTES___

Created on 10/23/2023, 2:09:01 PM


